\documentclass[10pt]{article}
    \usepackage[top=2cm,bottom=3cm,left=2cm,right=2cm]{geometry}

    % amsmath and amssymb packages, useful for mathematical formulas and symbols
    \usepackage{amsmath,amssymb}

    % Use Unicode characters when possible
    \usepackage[utf8]{inputenc}

    % textcomp package and marvosym package for additional characters
    \usepackage{textcomp,marvosym}

    % cite package, to clean up citations in the main text. Do not remove.
    \usepackage{cite}

    % Use nameref to cite supporting information files (see Supporting Information section for more info)
    \usepackage{nameref,hyperref}

    % line numbers
    \usepackage[right]{lineno}

    % ligatures disabled
    \usepackage{microtype}
    \DisableLigatures[f]{encoding = *, family = * }

    % color can be used to apply background shading to table cells only
    \usepackage[table]{xcolor}

    % array package and thick rules for tables
    \usepackage{array}

    \usepackage{tikz}
    \usetikzlibrary{calc}

\newcommand\samplesTikz{10}
\def\Spline#1#2#3#4#5#6#7#8{%Px Py Qx Qy px py qx qy
    plot (
        {   (#1) + (#5)*(\t) + (3*(#3) - 3*(#1) - 2*(#5) - (#7))*(\t)*(\t) + (2*(#1) - 2*(#3) + (#5) + (#7))*(\t)*(\t)*(\t)   },
        {   (#2) + (#6)*(\t) + (3*(#4) - 3*(#2) - 2*(#6) - (#8))*(\t)*(\t) + (2*(#2) - 2*(#4) + (#6) + (#8))*(\t)*(\t)*(\t)   }
    )
}
% \def\ESpline#1#2#3#4#5#6#7#8{%Px Py Qx Qy px py qx qy
%     plot (
%         {   (#1) + (#5)*(\t) + (3*(#3) - 3*(#1) - 2*(#5) - (#7))*(\t)*(\t) + (2*(#1) - 2*(#3) + (#5) + (#7))*(\t)*(\t)*(\t)   },
%         {   (#2) + (#6)*(\t) + (3*(#4) - 3*(#2) - 2*(#6) - (#8))*(\t)*(\t) + (2*(#2) - 2*(#4) + (#6) + (#8))*(\t)*(\t)*(\t)   }
%     )
% }

\DeclareMathOperator{\cis}{cis}
\DeclareMathOperator{\acos}{acos}
\DeclareMathOperator{\Lspline}{L}
\DeclareMathOperator{\nLspline}{nL}
\DeclareMathOperator{\Espline}{E}
\DeclareMathOperator{\Fspline}{F}
% for the drawing of examples taken from the c++ coded version. neccessary because TikZ constrols work different than the formulae of the Splines, I use
\newcommand\controlfactor{.32}

\title{Theory on Vi Hart's Flippy Chips}
\author{Anton Obersteiner}

\begin{document}
\maketitle

% \newpage
\section{Net}
    \begin{figure}
        \begin{tikzpicture}[scale=9]
            \draw[-latex]
            let
                \p{P} = (0, 0),
                \p{p1} = (2, -.5),
                \p{p2} = (-.5, -1.5),
                \p{Q} = (1, -.2),
                \p{q1} = (0, 1.5),
                \p{q2} = (2, 0),
                \p{R} = (.5, 1),
                \p{r1} = (-1, -1),
                \p{r2} = (-1, 2)
            in
                node[inner sep=0] (P)  at (\p{P}) {$\bullet$}
                node[inner sep=0] (p1) at ({\x{P}+\x{p1}/3}, {\y{P}+\y{p1}/3}) {}
                node[inner sep=0] (p2) at ({\x{P}+\x{p2}/3}, {\y{P}+\y{p2}/3}) {}
                node[inner sep=0] (Q)  at ({\x{Q}},       {\y{Q}}) {$\bullet$}
                node[inner sep=0] (q1) at ({\x{Q}+\x{q1}/3}, {\y{Q}+\y{q1}/3}) {}
                node[inner sep=0] (q2) at ({\x{Q}+\x{q2}/3}, {\y{Q}+\y{q2}/3}) {}
                node[inner sep=0] (R)  at (\p{R}) {$\bullet$}
                node[inner sep=0] (r1) at ({\x{R}+\x{r1}/3}, {\y{R}+\y{r1}/3}) {}
                node[inner sep=0] (r2) at ({\x{R}+\x{r2}/3}, {\y{R}+\y{r2}/3}) {};
            \draw[-latex] (P) node[below left] {$P$}  -> (p1) node[right]      {$\vec p_1$};
            \draw[-latex] (P)                         -> (p2) node[midway, left] {$\vec p_2$};
            \draw[-latex] (Q) node[above right] {$Q$} -> (q1) node[midway, right]      {$\vec q_1$};
            \draw[-latex] (Q)                         -> (q2) node[midway, above]      {$\vec q_2$};
            \draw[-latex] (R) node[right] {$R$}       -> (r1) node[left] {$\vec r_1$};
            \draw[-latex] (R)                         -> (r2) node[midway, below left] {$\vec r_2$};
            \draw[
                domain=0:1.03,
                % domain=-.1:1.1,
                samples=\samplesTikz,
                variable=\t
            ]
            let
                \p{P} = (0, 0),
                \p{p1} = (2, -.5),
                \p{p2} = (-.5, -1.5),
                \p{Q} = (1, -.2),
                \p{q1} = (0, 1.5),
                \p{q2} = (2, 0),
                \p{R} = (.5, 1),
                \p{r1} = (-1, -1),
                \p{r2} = (-1, 2)
            in
                \Spline{\x{P}}{\y{P}}{\x{Q}}{\y{Q}}{\x{p1}}{\y{p1}}{\x{q2}}{\y{q2}}
                \Spline{\x{Q}}{\y{Q}}{\x{R}}{\y{R}}{\x{q1}}{\y{q1}}{\x{r2}}{\y{r2}}
                \Spline{\x{R}}{\y{R}}{\x{P}}{\y{P}}{\x{r1}}{\y{r1}}{\x{p2}}{\y{p2}}
                % generated by test_PQR from main.cpp with F[v_].latex()
                %F
                \Spline{0}{0}{0.96875}{0.104687}{1.625}{0}{1.75}{0.25} node[above right] {$F(t, \frac 14)$}
                \Spline{0}{0}{0.875}{0.3375}{1.25}{0.5}{1.5}{0.5}      node[above right] {$F(t, \frac 12)$}
                \Spline{0}{0}{0.71875}{0.601562}{0.875}{1}{1.25}{0.75} node[above right] {$F(t, \frac 34)$}
                \Spline{0}{0}{0.5}{1}{0.5}{1.5}{1}{1}                  node[above right] {$F(t, 1)$}
                %E
                \Spline{0.34375}{-0.101562}{0.101562}{0.320312}{0.09375}{0.375}{-0.4375}{0.21875} node[above left] {$E(\frac 14, v)$}
                \Spline{0.5}{-0.1625}{0.1875}{0.5625}{0.125}{0.75}{-0.75}{0.625}                  node[above left] {$E(\frac 12, v)$}
                \Spline{0.65625}{-0.192188}{0.304688}{0.773438}{0.09375}{1.125}{-0.9375}{1.21875} node[above left] {$E(\frac 34, v)$}
                \Spline{1}{-0.2}{0.5}{1}{0}{1.5}{-1}{2}                                           node[left] {$E(1, v)$}
                % \foreach \t in {.1, .2, .3, .4}
                %     \Spline{\x{P}}{\y{P}}{\x{Q}}{\y{Q}}{\x{p1}}{\y{p1}}{\x{q2}}{\y{q2}}
            ;
        \end{tikzpicture}
        \caption{Net of $\Espline_{PQRp_1p_2q_1q_2r_1r_2}(t, v)$ and $\Fspline_{PQRp_1p_2q_1q_2r_1r_2}(t, v)$}
        \label{fig:eta}
    \end{figure}
    spanning a net:
    $$\begin{aligned}
        % L_{PQpq}^\prime(t) =& 3(2P - 2Q + p + q)t^2 - 2(3P - 3Q + 2p + q)t + p \\
        A(t) :=& \Lspline_{PQp_1q_2}(t) \\
        B(t) :=& \Lspline_{PR-p_2-r_1}(t) \\
        C(v) :=& \Lspline_{QRq_1r_2}(v) \\
        a(t) :=&  q_1t - p_2(1-t) \\
        b(t) :=&  r_2t - p_1(1-t) \\
        c(v) :=& -p_2v + p_1(1-v) \\
        d(v) :=& -r_1v + q_2(1-v) \\
        \Espline_{PQRp_1p_2q_1q_2r_1r_2}(t, v) =& \Lspline_{A(t),B(t),a(t),b(t)}(v) \\
        \Fspline_{PQRp_1p_2q_1q_2r_1r_2}(t, v) =& \Lspline_{P,C(v),c(v),d(v)}(t) \\
    \end{aligned}$$
    % and the circles:
    % $$\begin{aligned}
    %     r\cis(\theta_a) =& a(t_r) \\
    %     r\cis(\theta_b) =& b(u_r) \\
    % \end{aligned}$$
    % % find intersections: \\ solve for $t_r$:
    % % $$\begin{aligned}
    % %     T :=& (3Q-3P-2p-q) \\
    % %     U :=& (2P-2Q+p+q) \\
    % %     \Lspline_{PQpq}(t_r) = Ut_r^3 + Tt_r^2 + pt_r + P =& r\cis(\theta_a) \\
    % %     U_xt_r^3 + T_xt_r^2 + p_xt_r + P_x =& r\cos(\theta_a) \\
    % %     w_x :=& \frac{U_x}{U_y} \\
    % %     U_xt_r^3 + w_xT_yt_r^2 + w_xp_yt_r + w_xP_y =& w_xr\sin(\theta_a) \\
    % %     V_0 :=& w_xP_y-P_x \\
    % %     V_1 :=& w_xp_y-p_x \\
    % %     V_2 :=& w_xT_y-T_x \\
    % %     V_3 :=& w_x\sin(\theta_a) - \cos(\theta_a) \\
    % %     V_2t_r^2 + V_1t_r + V_0 =& V_3r \\
    % %     % t_r^2 + \frac{V_1}{V_2}t_r + \frac{V_0}{V_2} =& \frac{V_3r}{V_2} \\
    % %     t_r =& -\frac{V_1}{2V_2} \pm \sqrt{\left(\frac{V_1}{2V_2}\right)^2 - \frac{V_0}{V_2} + \frac{V_3r}{V_2}} \\
    % %     W_0 :=& -\frac{V_1}{2V_2} \\
    % %     W_1 :=& \left(\frac{V_1}{2V_2}\right)^2 - \frac{V_0}{V_2} \\
    % %     W_2 :=& \frac{1}{V_2} \\
    % %     t_r =& W_0 \pm \sqrt{W_1 + W_2r\left(w_x\sin(\theta_a) - \cos(\theta_a)\right)} \\
    % % \end{aligned}$$
    % % solve for $\theta_a$:
    % % $$\begin{aligned}
    % %     T :=& (3Q-3P-2p-q) \\
    % %     U :=& (2P-2Q+p+q) \\
    % %     re^{i\theta_a} =& \Lspline_{PQpq}(t_r) = Ut_r^3 + Tt_r^2 + pt_r + P \\
    % %     i\theta_a =& \ln\left(\frac{1}{r}(Ut_r^3 + Tt_r^2 + pt_r + P)\right) \\
    % %     \theta_a =& i\ln r \ln\left(Ut_r^3 + Tt_r^2 + pt_r + P\right) \\
    % % \end{aligned}$$
    % % combine:
    % % $$\begin{aligned}
    % %     t_r =& W_0 \pm \sqrt{W_1 + W_2r\left(w_x\sin(\theta_a) - \cos(\theta_a)\right)} \\
    % %     \theta_a =& i\ln r \ln\left(Ut_r^3 + Tt_r^2 + pt_r + P\right) \\
    % % \end{aligned}$$
    % find intersections: \\ distance $r$
    % $$\begin{aligned}
    %     T :=& (3Q-3P-2p-q) \\
    %     U :=& (2P-2Q+p+q) \\
    %     r  =& \left|\Lspline_{PQpq}(t_r) - \Lspline_{PQpq}(t_0)\right| \\
    %        =& \left|(Ut_r^3 + Tt_r^2 + pt_r + P) - (Ut_0^3 + Tt_0^2 + pt_0 + P)\right| \\
    %        =& \left|U(t_r^3 - t_0^3) + T(t_r^2 - t_0^2) + p(t_r - t_0)\right| \\
    %     r^2 =&  \left(U_x(t_r^3 - t_0^3) + T_x(t_r^2 - t_0^2) + p_x(t_r - t_0)\right)^2 +
    %             \left(U_y(t_r^3 - t_0^3) + T_y(t_r^2 - t_0^2) + p_y(t_r - t_0)\right)^2 \\
    % \end{aligned}$$
    % and SageMath tells me a solution is not to be found by the human mind...
    % \newpage
    % example:
    % $$\begin{aligned}
    %     a(t) =& \Lspline_{0,1,(1+i),(-1+i)}(t) = t + (-4-3i)t^2 + (-2+2i)t^3 \\
    %     %b(u)=& \Lspline_{0,1,(-1+i),(1+i)}(u) = u + ( 4-3i)u^2 + (-2+2i)u^3 \\
    %     T =& (-4-3i) \\
    %     U =& (-2+2i) \\
    %     V_0 =& 0 \\
    %     V_1 =& -1 \\
    %     V_2 =& -1-i \\
    %     V_3 =& (-\sin(\theta_a) - \cos(\theta_a)) \\
    %     t_r =& -\frac{-1}{-2-2i} \pm \sqrt{\left(\frac{1}{2+2i}\right)^2 - \frac{0}{-2-2i} + \frac{(-\sin(\theta_a) - \cos(\theta_a))r}{-2-2i}}
    % \end{aligned}$$
\newpage
\section{Graph}
    given the construction of the line $L$ from spline segments
    $L_0=\Lspline_{ABab}$, $L_1=\Lspline_{BCbc}$, $...$, $L_l$, $...$, $L_{|L|}=\Lspline_{.A.a}$ and the intersections within that line:
    $P_0, P_1, ..., P_p, ..., P_{|P|}$, where an intersection has two $L$-indice $l, m$ and the corresponding parameters $t, u$ so that $\Lspline_l(t) = \Lspline_m(u)$,
    what are the (internal) areas of the shape?
    \begin{figure}
        \begin{tikzpicture}[scale=8]
            \node (A) at (0.4, 0.8) {$\bullet$};
            \node (B) at (0.1, 1) {$\bullet$};
            \node (C) at (0.4, 0.2) {$\bullet$};
            \node (D) at (0.7, 1) {$\bullet$};
            \node (E) at (0.7, 0.2) {$\bullet$};
            \draw (A) node[below] {$A$} .. controls +({-1*\controlfactor}, {0*\controlfactor}) and +({-0.5*\controlfactor}, {-0.5*\controlfactor}) .. (B);
            \draw (B) node[below] {$B$} .. controls +({0.5*\controlfactor}, {0.5*\controlfactor}) and +({-1*\controlfactor}, {-0*\controlfactor}) .. (C);
            \draw (C) node[below] {$C$} .. controls +({1*\controlfactor}, {0*\controlfactor}) and +({1*\controlfactor}, {-0*\controlfactor}) .. (D);
            \draw (D) node[below] {$D$} .. controls +({-1*\controlfactor}, {0*\controlfactor}) and +({-1*\controlfactor}, {-0*\controlfactor}) .. (E);
            \draw (E) node[below] {$E$} .. controls +({1*\controlfactor}, {0*\controlfactor}) and +({1*\controlfactor}, {-0*\controlfactor}) .. (A);
            \node (P) at (0.1846, 0.808273) {$\bullet$};
            \draw (P) node[above right] {$P$};
            \node (Q) at (0.560517, 0.258828) {$\bullet$};
            \draw (Q) node[above] {$Q$};
            \node (R) at (0.776839, 0.544064) {$\bullet$};
            \draw (R) node[right] {$R$};
            \node (S) at (0.477184, 0.790679) {$\bullet$};
            \draw (S) node[above right] {$S$};
            \node (QSP) at (.32, .5) {$QSP$};
            \node (QRS) at (.6, .5) {$QRS$};
            \node (QR) at (.72, .3) {$QR$};
            \node (RS) at (.7, .85) {$RS$};
            \node (P) at (0.12, .9) {$P$};
        \end{tikzpicture}
        \caption{}
        \label{}
    \end{figure}
\newpage
\section{Finding $\eta(z)$}
    given: \\
    two borders of the shape, $A(t), B(u)$, defined as splines. \\
    the value at the borders, going up and down:
    $$\begin{aligned}
        \eta(A(t))      =& \cos(\pi t) \\
        \eta(B(u))      =& -\cos(\pi u) \\
    \end{aligned}$$
    linear interpolation:
    $$\begin{aligned}
        \eta(r\cis(\theta)) =& \eta(a(t_r))(\theta-\theta_b) + \eta(b(u_r))(\theta-\theta_a) & & \\
        \lim_{\zeta\to 0}\left(\frac{\eta(\zeta\cis\alpha)}{\zeta\cis\alpha}\right) =& 0 \\
    \end{aligned}$$
\section{intersection of a spline with a straight line}
    given a line $P + pu$ for $u \in \mathbb{R}$ and the Spline $\Lspline_{ABab}(t)$ with $t \in [0, 1]$, how many intersections are there between the two?
    $$\begin{aligned}
        P + pu =& A + at + (3B - 3A - 2a - b)t^2 + (2A - 2B + a + b)t^3 \\
        T :=& (3B - 3A - 2a - b) \\
        U :=& (2A - 2B + a + b) \\
        P_x + p_xu =& A_x + a_xt + T_xt^2 + U_xt^3 \\
        w_x :=& \frac{U_x}{U_y} \\
        (w_xP_y - P_x) + (w_xp_y - p_x)u =& (w_xA_y - A_x) + (w_xa_y - a_x)t + (w_xT_y - T_x)t^2 \\
        V_0 :=& \frac{(w_xA_y - A_x) - (w_xP_y - P_x)}{w_xp_y - p_x} \\
        V_1 :=& \frac{(w_xa_y - a_x)}{w_xp_y - p_x} \\
        V_2 :=& \frac{(w_xT_y - T_x)}{w_xp_y - p_x} \\
        u =& V_0 + V_1t + V_2t^2 \\
        P_x + p_x\left(V_0 + V_1t + V_2t^2\right) =& A_x + a_xt + T_xt^2 + U_xt^3 \\
        0 =& A_x - P_x - p_xV_0 + (a_x - p_xV_1)t + (T_x - p_xV_2)t^2 + U_xt^3 \\
        W_0 :=& \frac{A_x - P_x - p_xV_0}{U_x} \\
        W_1 :=& \frac{a_x - p_xV_1}{U_x} \\
        W_2 :=& \frac{T_x - p_xV_2}{U_x} \\
        0 =& W_0 + W_1t + W_2t^2 + t^3 \\
        e :=& \frac{-W_2}{3} \\
        f :=& e^3 + \frac{W_2W_1-3W_0}{6} \\
        g :=& \frac{W_1}{3} \\
        h :=& \sqrt{f^2 + (g - e^2)^3} \\
        t =& \sqrt[3]{f + h} + \sqrt[3]{f - h} + e \\
    \end{aligned}$$
    % example:
    % $$\begin{aligned}
    %     0 + (1+i)u =& (.15 + .9i) + -t
    %       + (3(.45 + .1i) - 3(.15 + .9i) - 2(.5 + .5i) - 1)t^2 \\
    %      &+ (2(.15 + .9i) - 2(.45 + .1i) +  (.5 + .5i) + 1)t^3 \\
    %     T :=& (3(.45 + .1i) - 3(.15 + .9i) - 2(.5 + .5i) - 1) = -1.1 - 3.4j \\
    %     U :=& (2(.15 + .9i) - 2(.45 + .1i) +  (.5 + .5i) + 1) = .9 + 2.1j \\
    %     0 + 1u =& .15 + .5t - 1.1t^2 + .9t^3 \\
    %     w_x :=& \frac{.9}{2.1} = .43 \\
    %     (.43\cdot 0 - 0) + (.43 - 1)u =& (.43\cdot .9 - .15) + (.43\cdot .5 - .5)t + (.43\cdot -1.1 - T_y)t^2 \\
    %     w_p := \frac{1}{.43 - 1} = -1.75 \\
    %     V_0 :=& ((.43\cdot.9 - .15) - (0 - 0))\cdot -1.75 = -.41 \\
    %     V_1 :=& (.43\cdot.5 - .5)\cdot -1.75 = .5 \\
    %     V_2 :=& (.43\cdot-3.4 + 1.1)\cdot -1.75 = .63 \\
    %     u =& -.41 + .5t + .63t^2 \\
    %     P_x + p_x\left(-.41 + .5t + .63t^2\right) =& A_x + a_xt + T_xt^2 + U_xt^3 \\
    %     0 =& A_x - P_x - p_x\cdot-.41 + (a_x - p_x\cdot.5)t + (T_x - p_x\cdot.63)t^2 + U_xt^3 \\
    %     W_0 :=& \frac{.15 - 0 - 1\cdot-.41}{2.1} = .63 \\
    %     W_1 :=& \frac{.5 - 1\cdot.5}{2.1} = 0 \\
    %     W_2 :=& \frac{-1.1 - 1\cdot.63}{2.1} = -1.9 \\
    %     0 =& W_0 + W_1t + W_2t^2 + t^3 = t^3 -1.9t^2 + .63 \\
    %     p :=& \frac{0+1.9^2}{3} = -1.2 \\
    %     q :=& \frac{2\cdot-1.9^3}{27} - \frac{-1.9\cdot 0}{3} + .63 = .1 \\
    %     D :=& (-1.2/3)^3 + (.1/2)^2 = -.06 \\
    %     r :=& \sqrt{-{\frac p 3}^3} = \sqrt{.4^3} = .64 \\
    %     \cos\phi =& \frac{-q}{2r} \\
    %     \phi :=& \acos\left(\frac{-q}{2r}\right) = 1.65 \\
    % \end{aligned}$$
\end{document}
